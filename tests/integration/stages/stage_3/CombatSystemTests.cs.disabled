// <copyright file="CombatSystemTests.cs" company="Ωmega Spiral">
// Copyright (c) Ωmega Spiral. All rights reserved.
// </copyright>

namespace OmegaSpiral.Tests.Stages.Stage4;

using GdUnit4;
using Godot;
using static GdUnit4.Assertions;

/// <summary>
/// Tests for Stage 4 combat system.
/// Verifies combat initialization, turn queue, and action execution.
/// </summary>
[TestSuite]
public class CombatSystemTests
{
    /// <summary>
    /// Verifies CombatEvents singleton exists.
    /// </summary>
    [TestCase]
    [RequireGodotRuntime]
    public static void TestCombatEventsExists()
    {
        var combatEvents = GD.Load<CSharpScript>("res://source/scripts/combat/CombatEvents.cs");
        AssertThat(combatEvents).IsNotNull();
    }

    /// <summary>
    /// Verifies Combat main controller exists.
    /// </summary>
    [TestCase]
    [RequireGodotRuntime]
    public static void TestCombatControllerExists()
    {
        var combat = GD.Load<CSharpScript>("res://source/scripts/combat/Combat.cs");
        AssertThat(combat).IsNotNull();
    }

    /// <summary>
    /// Verifies CombatActor script exists.
    /// </summary>
    [TestCase]
    [RequireGodotRuntime]
    public static void TestCombatActorExists()
    {
        var combatActor = GD.Load<CSharpScript>("res://source/scripts/combat/CombatActor.cs");
        AssertThat(combatActor).IsNotNull();
    }

    /// <summary>
    /// Verifies ActiveTurnQueue exists.
    /// </summary>
    [TestCase]
    [RequireGodotRuntime]
    public static void TestActiveTurnQueueExists()
    {
        var turnQueue = GD.Load<CSharpScript>("res://source/scripts/combat/ActiveTurnQueue.cs");
        AssertThat(turnQueue).IsNotNull();
    }

    /// <summary>
    /// Verifies BattlerActionAttack exists.
    /// </summary>
    [TestCase]
    [RequireGodotRuntime]
    public static void TestAttackActionExists()
    {
        var attackAction = GD.Load<CSharpScript>("res://source/scripts/combat/actions/BattlerActionAttack.cs");
        AssertThat(attackAction).IsNotNull();
    }

    /// <summary>
    /// Verifies BattlerActionHeal exists.
    /// </summary>
    [TestCase]
    [RequireGodotRuntime]
    public static void TestHealActionExists()
    {
        var healAction = GD.Load<CSharpScript>("res://source/scripts/combat/actions/BattlerActionHeal.cs");
        AssertThat(healAction).IsNotNull();
    }

    /// <summary>
    /// Verifies Combat Ui exists.
    /// </summary>
    [TestCase]
    [RequireGodotRuntime]
    public static void TestCombatUiExists()
    {
        var combatUi = GD.Load<CSharpScript>("res://source/scripts/combat/ui/UiCombatMenus.cs");
        AssertThat(combatUi).IsNotNull();
    }

    /// <summary>
    /// Verifies combat arena scene exists.
    /// </summary>
    [TestCase]
    [RequireGodotRuntime]
    public static void TestCombatArenaSceneExists()
    {
        var arenaScene = ResourceLoader.Exists("res://source/overworld/maps/town/battles/test_combat_arena.tscn");
        AssertThat(arenaScene).IsTrue();
    }
}
