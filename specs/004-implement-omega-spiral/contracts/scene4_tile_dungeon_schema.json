{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://omega-spiral.dev/contracts/scene4_tile_dungeon_schema.json",
  "title": "Tile Dungeon Schema",
  "description": "JSON schema for 2D tile-based dungeon exploration data",
  "type": "object",
  "properties": {
    "type": { "type": "string", "enum": [ "tile_dungeon" ], "description": "Scene type identifier" },
    "tilemap": {
      "type": "array",
      "items": {
        "type": "string",
        "pattern": "^[#.@D K T E \\s]{10,40}$",
        "description": "Tile map row (walls, floors, objects, player position)"
      },
      "minItems": 8,
      "maxItems": 25,
      "description": "2D tile grid representing dungeon layout"
    },
    "legend": {
      "type": "object",
      "patternProperties": {
        "^.$": {
          "type": "object",
          "properties": {
            "name": { "type": "string", "minLength": 1, "maxLength": 20, "description": "Display name for this tile type" },
            "walkable": { "type": "boolean", "description": "Whether player can walk on this tile" },
            "interactable": { "type": "boolean", "description": "Whether player can interact with this tile" },
            "description": { "type": "string", "minLength": 5, "maxLength": 100, "description": "Description of what this tile represents" }
          },
          "required": [ "name", "walkable", "interactable" ]
        }
      },
      "propertyNames": { "pattern": "^.$" },
      "description": "Mapping of tile characters to properties"
    },
    "uiPanels": {
      "type": "object",
      "properties": {
        "inventory": { "type": "boolean", "description": "Whether to show inventory panel" },
        "map": { "type": "boolean", "description": "Whether to show mini-map panel" },
        "stats": {
          "type": "array",
          "items": { "type": "string", "pattern": "^[A-Za-z]+: [0-9/]+$", "description": "Stat display format (e.g., 'HP: 24/24')" },
          "minItems": 1,
          "maxItems": 6,
          "description": "Character stats to display in UI"
        }
      },
      "description": "UI panels to display during dungeon exploration"
    },
    "controls": { "type": "string", "minLength": 10, "maxLength": 200, "description": "Control instructions displayed to player" },
    "exitCondition": {
      "type": "string",
      "enum": [ "open_door", "find_key", "find_treasure", "defeat_enemy", "solve_puzzle" ],
      "description": "Condition that must be met to exit the dungeon"
    },
    "interactions": {
      "type": "object",
      "patternProperties": {
        "^[A-Za-z_]+$": {
          "type": "object",
          "properties": {
            "trigger": {
              "type": "string",
              "enum": [ "on_walk", "on_interact", "on_condition" ],
              "description": "When this interaction should trigger"
            },
            "condition": { "type": "string", "description": "Optional condition that must be met" },
            "narrative": { "type": "string", "minLength": 10, "maxLength": 300, "description": "Text displayed when interaction occurs" },
            "effect": {
              "type": "string",
              "enum": [ "unlock_door", "add_item", "update_stat", "show_message", "transition_scene" ],
              "description": "Effect of this interaction"
            }
          },
          "required": [ "trigger", "narrative", "effect" ]
        }
      },
      "description": "Optional interaction definitions for special tiles"
    }
  },
  "required": [
    "type",
    "tilemap",
    "legend",
    "uiPanels",
    "controls",
    "exitCondition"
  ]
}
